<svg width="960" height="240" viewBox="0 0 960 240" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .node-box {
        fill: #020617;
        stroke: #38bdf8;
        stroke-width: 1.5;
        rx: 6;
        ry: 6;
      }
      .node-text {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        font-size: 11px;
        fill: #e5e7eb;
      }
      .title-text {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        font-size: 12px;
        fill: #9ca3af;
      }
      .arrow {
        stroke: #64748b;
        stroke-width: 1.5;
        fill: none;
        marker-end: url(#arrowhead);
      }
      .arrow-label {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        font-size: 10px;
        fill: #9ca3af;
      }
    </style>
    <marker id="arrowhead" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <polygon points="0 0, 8 4, 0 8" fill="#64748b" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="480" y="24" text-anchor="middle" class="title-text">
    Top-level audio processing pipeline
  </text>

  <!-- Nodes -->
  <!-- A: Input -->
  <rect x="20" y="70" width="150" height="50" class="node-box"/>
  <text x="95" y="90" text-anchor="middle" class="node-text">Audio input</text>
  <text x="95" y="106" text-anchor="middle" class="node-text">(upload or URL)</text>

  <!-- B: Pre-processing -->
  <rect x="190" y="70" width="180" height="50" class="node-box"/>
  <text x="280" y="96" text-anchor="middle" class="node-text">
    Pre-processing
  </text>
  <text x="280" y="112" text-anchor="middle" class="node-text">
    mono 16 kHz + validation
  </text>

  <!-- C: Language gate -->
  <rect x="400" y="70" width="180" height="50" class="node-box"/>
  <text x="490" y="96" text-anchor="middle" class="node-text">
    Language gate (EN/FR only)
  </text>

  <!-- D: Transcription -->
  <rect x="610" y="40" width="150" height="50" class="node-box"/>
  <text x="685" y="70" text-anchor="middle" class="node-text">
    Transcription
  </text>

  <!-- E: VAD retry + fallback -->
  <rect x="610" y="130" width="200" height="60" class="node-box"/>
  <text x="710" y="152" text-anchor="middle" class="node-text">
    VAD retry + EN/FR
  </text>
  <text x="710" y="168" text-anchor="middle" class="node-text">
    scoring fallback
  </text>

  <!-- F: Optional translation -->
  <rect x="800" y="40" width="150" height="50" class="node-box"/>
  <text x="875" y="62" text-anchor="middle" class="node-text">
    Optional translation
  </text>
  <text x="875" y="78" text-anchor="middle" class="node-text">
    (ENâ†”FR)
  </text>

  <!-- G: Result JSON + metrics -->
  <rect x="800" y="140" width="150" height="60" class="node-box"/>
  <text x="875" y="162" text-anchor="middle" class="node-text">
    Result JSON + metrics
  </text>
  <text x="875" y="178" text-anchor="middle" class="node-text">
    DB &amp; /jobs/{id}/result
  </text>

  <!-- Arrows main flow -->
  <line x1="170" y1="95" x2="190" y2="95" class="arrow" />
  <line x1="370" y1="95" x2="400" y2="95" class="arrow" />
  <line x1="580" y1="65" x2="610" y2="65" class="arrow" />
  <line x1="760" y1="65" x2="800" y2="65" class="arrow" />
  <line x1="760" y1="160" x2="800" y2="160" class="arrow" />

  <!-- Arrow A -> B -->
  <line x1="170" y1="95" x2="190" y2="95" class="arrow" />

  <!-- Arrow B -> C -->
  <line x1="370" y1="95" x2="400" y2="95" class="arrow" />

  <!-- Arrow C -> D (high confidence EN/FR) -->
  <line x1="580" y1="65" x2="610" y2="65" class="arrow" />
  <text x="595" y="58" text-anchor="middle" class="arrow-label">
    high-confidence EN/FR
  </text>

  <!-- Arrow C -> E (uncertain / other language) -->
  <line x1="490" y1="120" x2="490" y2="150" class="arrow" />
  <line x1="490" y1="150" x2="610" y2="160" class="arrow" />
  <text x="500" y="138" class="arrow-label">
    uncertain or other
  </text>

  <!-- Arrow E -> D -->
  <line x1="610" y1="160" x2="610" y2="90" class="arrow" />
  <text x="620" y="128" class="arrow-label">
    improved EN/FR
  </text>

  <!-- Arrow D -> F -->
  <line x1="760" y1="65" x2="800" y2="65" class="arrow" />

  <!-- Arrow F -> G -->
  <line x1="875" y1="90" x2="875" y2="140" class="arrow" />

  <!-- Arrow D -> G (no translation) -->
  <line x1="685" y1="90" x2="685" y2="140" class="arrow" />
  <line x1="685" y1="140" x2="800" y2="160" class="arrow" />
  <text x="690" y="134" class="arrow-label">
    no translation
  </text>
</svg>
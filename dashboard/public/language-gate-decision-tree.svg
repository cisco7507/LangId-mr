<svg width="900" height="360" viewBox="0 0 900 360" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .node-box {
        fill: #020617;
        stroke: #4ade80;
        stroke-width: 1.5;
        rx: 6;
        ry: 6;
      }
      .node-text {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        font-size: 11px;
        fill: #e5e7eb;
      }
      .title-text {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        font-size: 12px;
        fill: #9ca3af;
      }
      .arrow {
        stroke: #64748b;
        stroke-width: 1.5;
        fill: none;
        marker-end: url(#arrowhead);
      }
      .arrow-label {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        font-size: 10px;
        fill: #9ca3af;
      }
      .badge {
        font-size: 10px;
        fill: #bbf7d0;
      }
    </style>
    <marker id="arrowhead" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <polygon points="0 0, 8 4, 0 8" fill="#64748b" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="450" y="24" text-anchor="middle" class="title-text">
    EN/FR language gate decision tree
  </text>

  <!-- A: Model prediction -->
  <rect x="320" y="50" width="260" height="50" class="node-box"/>
  <text x="450" y="72" text-anchor="middle" class="node-text">
    Model prediction
  </text>
  <text x="450" y="88" text-anchor="middle" class="node-text">
    (language, probability)
  </text>

  <!-- B: language in {en, fr}? -->
  <rect x="320" y="130" width="260" height="50" class="node-box"/>
  <text x="450" y="152" text-anchor="middle" class="node-text">
    language in {en, fr}?
  </text>

  <!-- C: ENFR_STRICT_REJECT? -->
  <rect x="80" y="210" width="260" height="50" class="node-box"/>
  <text x="210" y="234" text-anchor="middle" class="node-text">
    ENFR_STRICT_REJECT?
  </text>

  <!-- D: Reject -->
  <rect x="40" y="290" width="260" height="50" class="node-box"/>
  <text x="170" y="312" text-anchor="middle" class="node-text">
    Reject (HTTP 400)
  </text>
  <text x="170" y="328" text-anchor="middle" class="node-text">
    Only English/French audio supported
  </text>

  <!-- E: Fallback scoring -->
  <rect x="340" y="290" width="260" height="50" class="node-box"/>
  <text x="470" y="312" text-anchor="middle" class="node-text">
    EN/FR scoring fallback
  </text>
  <text x="470" y="328" text-anchor="middle" class="node-text">
    method = "fallback"
  </text>

  <!-- F: probability >= threshold? -->
  <rect x="600" y="210" width="260" height="50" class="node-box"/>
  <text x="730" y="234" text-anchor="middle" class="node-text">
    probability ≥ threshold?
  </text>

  <!-- G: Accept autodetect -->
  <rect x="640" y="290" width="220" height="50" class="node-box"/>
  <text x="750" y="312" text-anchor="middle" class="node-text">
    Accept (method = "autodetect")
  </text>

  <!-- H: VAD retry -->
  <rect x="600" y="130" width="260" height="50" class="node-box"/>
  <text x="730" y="152" text-anchor="middle" class="node-text">
    VAD retry on speech-only audio
  </text>
  <text x="730" y="168" text-anchor="middle" class="node-text">
    method = "autodetect-vad"
  </text>

  <!-- I: now confident EN/FR? -->
  <rect x="600" y="210" width="260" height="50" class="node-box" opacity="0" />
  <!-- (we reuse F for this branch label via arrows/labels) -->

  <!-- Arrows: A -> B -->
  <line x1="450" y1="100" x2="450" y2="130" class="arrow" />

  <!-- Arrows: B -> C (no) -->
  <line x1="320" y1="155" x2="210" y2="210" class="arrow" />
  <text x="330" y="176" class="arrow-label">no</text>

  <!-- Arrows: C -> D (yes) -->
  <line x1="210" y1="260" x2="170" y2="290" class="arrow" />
  <text x="195" y="276" class="arrow-label">yes</text>

  <!-- Arrows: C -> E (no) -->
  <line x1="340" y1="235" x2="470" y2="290" class="arrow" />
  <text x="360" y="252" class="arrow-label">no</text>

  <!-- Arrows: B -> F (yes) -->
  <line x1="580" y1="155" x2="730" y2="210" class="arrow" />
  <text x="585" y="176" class="arrow-label">yes</text>

  <!-- Arrows: F -> G (yes) -->
  <line x1="730" y1="260" x2="750" y2="290" class="arrow" />
  <text x="742" y="276" class="arrow-label">yes</text>

  <!-- Arrows: F -> H (no) -->
  <line x1="730" y1="210" x2="730" y2="180" class="arrow" />
  <text x="742" y="200" class="arrow-label">no</text>

  <!-- Arrows: H -> G / E via labels -->
  <line x1="730" y1="180" x2="470" y2="290" class="arrow" />
  <text x="620" y="220" class="arrow-label">still uncertain → fallback</text>

  <line x1="730" y1="180" x2="750" y2="290" class="arrow" opacity="0" />

  <!-- Legend badges -->
  <text x="470" y="260" text-anchor="middle" class="badge">
    non-EN/FR or low confidence
  </text>
</svg>
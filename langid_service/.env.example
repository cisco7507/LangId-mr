# LangID Service â€” sample configuration
# Copy this file to `.env` and adjust values as needed.

# --- Core runtime ---
# Directory for service logs (relative paths resolve from langid_service/)
LOG_DIR=logs

# Application log verbosity (set to DEBUG for verbose troubleshooting)
LOG_LEVEL=INFO

# Directory for uploaded/downloaded audio files
STORAGE_DIR=storage

# Database URL (SQLite path or external DSN)
DB_URL=sqlite:///langid.sqlite

# Number of background worker processes that handle jobs
# TUNING GUIDELINES:
# - Use ~85% of physical cores (leave some for OS, HTTP server, DB I/O)
# - For dual Xeon E5-2660 v4 (28 physical cores): MAX_WORKERS=24
# - For single CPU systems: Use (physical_cores - 2) to (physical_cores - 4)
# - Do NOT use logical/hyperthreaded core counts for CPU-heavy workloads
# - Monitor CPU usage; if <80%, increase workers. If >95%, decrease.
MAX_WORKERS=24

# Maximum allowed upload size in megabytes
MAX_FILE_SIZE_MB=100

# How many times a failed job can be retried before being marked failed
MAX_RETRIES=3

# --- Whisper model ---
# Available sizes: tiny, base, small, medium, large-v3
WHISPER_MODEL_SIZE=base

# Device selector: cpu, cuda, or auto (auto = cuda when available)
WHISPER_DEVICE=auto

# Optional quantization hint used by Windows service scripts
WHISPER_COMPUTE=float16

# --- Language gate (EN/FR guardrail) ---
# Comma-separated list of languages allowed after fallback scoring
ALLOWED_LANGS=en,fr

# Minimum probability required to accept autodetect/VAD results
LANG_DETECT_MIN_PROB=0.6

# Probability thresholds for mid-zone heuristic (autodetect mid confidence range)
LANG_MID_LOWER=0.60
LANG_MID_UPPER=0.79

# Minimum stopword ratios required when mid confidence is detected
LANG_MIN_STOPWORD_EN=0.15
LANG_MIN_STOPWORD_FR=0.15

# Additional stopword margin difference required between languages
LANG_STOPWORD_MARGIN=0.05

# ----------------------------------------------------------------------------
# Language Code Format
# ----------------------------------------------------------------------------
# Controls the format of language codes in API responses and dashboard
# Options: iso639-1 (en, fr), iso639-2b (eng, fre), iso639-2t (eng, fra), iso639-3 (eng, fra)
LANG_CODE_FORMAT=iso639-3

# Minimum token count before heuristics fire
LANG_MIN_TOKENS=10

 ----------------------------------------------------------------------------
# Cluster Configuration (Optional - for HA deployments)
# ----------------------------------------------------------------------------
# Path to cluster_config.json for multi-node deployments
# Leave commented for standalone single-server deployments
# LANGID_CLUSTER_CONFIG_FILE=C:\ProgramData\LangID\cluster_config.json

# ----------------------------------------------------------------------------
# Database Optimization
# ----------------------------------------------------------------------------
# IMPORTANT: Enable SQLite WAL mode for concurrent worker access
# Run this command once after creating the database:
# sqlite3 langid.sqlite "PRAGMA journal_mode=WAL;"

# This prevents "database is locked" errors with multiple workers.


# When true, reject any clip that is not confidently EN/FR (HTTP 400)
ENFR_STRICT_REJECT=False
# --- HTTP bindings / Windows launcher helpers ---
# Host/port consumed by langid_service/scripts/windows/run_server.py
APP_HOST=0.0.0.0
APP_PORT=8080
